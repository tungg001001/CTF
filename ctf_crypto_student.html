<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>CTF å¤å…¸å¯†ç¢¼å­¸ï¼ˆHint + CSV + FLAGï¼‰</title>
<style>
body { background:#0b0b0b; color:#eee; font-family:"Microsoft JhengHei"; padding:20px; }
h1 { color:#00ffcc; }
.block { background:#1a1a1a; padding:15px; margin-bottom:15px; border-left:5px solid #00ffcc; }
input { width:100%; padding:6px; background:#222; color:#0f0; border:1px solid #555; }
button { margin-top:6px; padding:6px 12px; background:#00ffcc; border:none; cursor:pointer; }
button:disabled { background:#555; cursor:not-allowed; }
.hint { display:none; margin-top:6px; color:#ffd700; }
.correct { color:#0f0; }
.wrong { color:#f55; }
</style>
</head>

<body>

<h1>ğŸ›ï¸ å¤å…¸å¯†ç¢¼å­¸ CTFï¼ˆHint + CSV + FLAGï¼‰</h1>

<div class="block">
<h3>ğŸ‘¤ ä½œç­”è€…è³‡è¨Š</h3>
ç­ç´š <input id="cls">
åº§è™Ÿ <input id="num">
å§“å <input id="name">
</div>

<div id="quiz"></div>

<button id="submitBtn" onclick="submit()">é€å‡ºä½œç­”</button>
<button onclick="exportCSV()">ğŸ“¥ åŒ¯å‡º CSV</button>

<div class="block" id="result"></div>

<script>
// =======================
// è¨­å®š
// =======================
const POINT_PER_QUESTION = 10;
let penalty = 0;
let submitted = false;

// =======================
// é¡Œç›® / ç­”æ¡ˆ / æç¤º
// =======================
const data = [
{ q:"ZHOFRPH WR WKH SDVW", a:"WELCOME TO THE PAST", h1:"è©¦è©¦æœ€ç¶“å…¸çš„ä½ç§»æ–¹å¼", h2:"Caesar Cipherï¼Œä½ç§» = 3" },
{ q:"KHOOR ZRUOG", a:"HELLO WORLD", h1:"å­—æ¯è¡¨ä¸€å®šæ˜¯ Aâ†’Z å—ï¼Ÿ", h2:"åå‘å­—æ¯è¡¨ + ä½ç§»" },
{ q:"LXFOPVEFRNHR", a:"ATTACKATDAWN", h1:"è¦å‰‡åœ¨é‡è¤‡å¾ªç’°", h2:"VigenÃ¨re Cipherï¼ˆç¶“å…¸ä¾‹ï¼‰" },
{ q:"QWERTYUIOPASDFGHJKL", a:"ABCDEFGHIJKLMNOPQRSTUVWXYZ", h1:"åŒå­—æ¯ä¸åŒä½ç½®çµæœä¸åŒ", h2:"Progressive / Running Shift" },
{ q:"TIEH  SI  SCEERT", a:"THIS IS SECRET", h1:"æ²’æœ‰æ›¿æ›ä»»ä½•å­—æ¯", h2:"Transpositionï¼ˆå…©å…©äº¤æ›ï¼‰" },
{ q:"GATLMZCLRQTX", a:"INSTRUMENT", h1:"ä¸€æ¬¡è™•ç†å…©å€‹å­—æ¯", h2:"Playfair Cipherï¼ˆI/J åˆä½µï¼‰" },
{ q:"Uifsf jt b tfdsfu", a:"THERE IS A SECRET", h1:"æ¯å€‹å­—æ¯åªå·®ä¸€é»é»", h2:"Caesar -1" },
{ q:"7-4-11-11-14", a:"HELLO", h1:"æ•¸å­—å°æ‡‰å­—æ¯", h2:"A1Z26" },
{ q:";ppl rpwld", a:"HELLO WORLD", h1:"ä¸æ˜¯å­—æ¯è¡¨é †åº", h2:"QWERTY éµç›¤ä½ç§»" },
{ q:"HWEOLRLLOD", a:"HELLO WORLD", h1:"å­—æ¯éƒ½åœ¨ï¼Œåªæ˜¯é †åºæ€ª", h2:"Transposition + Caesar" }
];

// =======================
// é¡Œç›®ç”Ÿæˆ
// =======================
const quiz = document.getElementById("quiz");

data.forEach((d,i)=>{
 quiz.innerHTML += `
 <div class="block">
 <b>ç¬¬ ${i+1} é¡Œï¼ˆ10 åˆ†ï¼‰</b>
 <pre>${d.q}</pre>
 <input id="a${i}" placeholder="è¼¸å…¥æ˜æ–‡">
 <br>
 <button class="hintBtn" onclick="showHint(${i},1)">Hint 1</button>
 <button class="hintBtn" onclick="showHint(${i},2)">Hint 2</button>
 <div id="h${i}1" class="hint">ğŸ’¡ ${d.h1}</div>
 <div id="h${i}2" class="hint">ğŸ’¡ ${d.h2}</div>
 <div id="r${i}"></div>
 </div>`;
});

// =======================
// é¡¯ç¤ºæç¤ºï¼ˆæ‰£åˆ†ï¼‰
// =======================
function showHint(i,n){
 if(submitted) return;
 const h = document.getElementById(`h${i}${n}`);
 if(h.style.display !== "block"){
   h.style.display = "block";
   penalty += (n === 1 ? 0.5 : 1);
 }
}

// =======================
// ä½œç­”èˆ‡é–å®š
// =======================
function submit(){

 if(submitted){
   alert("å·²é€å‡ºä½œç­”ï¼Œä¸èƒ½å†æ¬¡ä½œç­”ï¼");
   return;
 }

 const cls  = document.getElementById("cls").value;
 const num  = document.getElementById("num").value;
 const name = document.getElementById("name").value;

 if(!cls || !num || !name){
   alert("è«‹å¡«å¯« ç­ç´š / åº§è™Ÿ / å§“å");
   return;
 }

 let correctCount = 0;

 data.forEach((d,i)=>{
   const input = document.getElementById("a"+i);
   const v = input.value.trim().toUpperCase();
   const r = document.getElementById("r"+i);

   if(v === d.a){
     r.innerHTML = "âœ” æ­£ç¢º";
     r.className = "correct";
     correctCount++;
   } else {
     r.innerHTML = "âœ˜ éŒ¯èª¤";
     r.className = "wrong";
   }

   input.disabled = true; // ğŸ”’ é–å®šç­”æ¡ˆ
 });

 // ğŸ”’ é–å®š Hint
 document.querySelectorAll(".hintBtn").forEach(b=>b.disabled=true);

 const rawScore   = correctCount * POINT_PER_QUESTION;
 const finalScore = Math.max(0, rawScore - penalty);

 const flag = (correctCount === data.length)
   ? "<br>ğŸ´ FLAG{HINTS_ARE_DOUBLE_EDGED}"
   : "";

 document.getElementById("result").innerHTML = `
 ${cls} ${num} ${name}<br>
 ç­”å°é¡Œæ•¸ï¼š${correctCount} / ${data.length}<br>
 åŸå§‹åˆ†æ•¸ï¼š${rawScore}<br>
 æç¤ºæ‰£åˆ†ï¼š${penalty}<br>
 <b>æœ€çµ‚åˆ†æ•¸ï¼š${finalScore}</b>
 ${flag}
 `;

 document.getElementById("submitBtn").disabled = true;
 submitted = true;
}

// =======================
// CSV åŒ¯å‡ºï¼ˆUTF-8 BOMï¼‰
// =======================
function exportCSV(){
 const headers = ["ç­ç´š","åº§è™Ÿ","å§“å"];
 for(let i=0;i<data.length;i++) headers.push(`ç¬¬${i+1}é¡Œ`);
 headers.push("åŸå§‹åˆ†æ•¸","æç¤ºæ‰£åˆ†","æœ€çµ‚åˆ†æ•¸");

 const cls  = document.getElementById("cls").value;
 const num  = document.getElementById("num").value;
 const name = document.getElementById("name").value;

 let answers = [];
 let correctCount = 0;

 for(let i=0;i<data.length;i++){
   const v = document.getElementById("a"+i).value.trim().toUpperCase();
   answers.push(v);
   if(v === data[i].a) correctCount++;
 }

 const rawScore   = correctCount * POINT_PER_QUESTION;
 const finalScore = Math.max(0, rawScore - penalty);

 let row = [cls,num,name,...answers,rawScore,penalty,finalScore];

 let csv = headers.join(",") + "\n";
 csv += row.map(v=>`"${v}"`).join(",") + "\n";

 const BOM = "\uFEFF";
 const blob = new Blob([BOM + csv], { type:"text/csv;charset=utf-8;" });

 const a = document.createElement("a");
 a.href = URL.createObjectURL(blob);
 a.download = `${cls}_${num}_${name}_ctf.csv`;
 a.click();
}
</script>

</body>
</html>