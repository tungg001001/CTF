<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>CTF ç¶œåˆé¡Œï¼ˆHint + CSV + FLAG + æ•™å¸«è§£ç­”ï¼‰</title>
<style>
body { background:#0b0b0b; color:#eee; font-family:"Microsoft JhengHei"; padding:20px; }
h1 { color:#00ffcc; }
.block { background:#1a1a1a; padding:15px; margin-bottom:15px; border-left:5px solid #00ffcc; }
input { width:100%; padding:6px; background:#222; color:#0f0; border:1px solid #555; }
button { margin-top:6px; padding:6px 12px; background:#00ffcc; border:none; cursor:pointer; }
button:disabled { background:#555; cursor:not-allowed; }
.hint { display:none; margin-top:6px; color:#ffd700; }
.correct { color:#0f0; }
.wrong { color:#f55; }
</style>
</head>
<body>

<h1>ğŸ´ CTF ç¶œåˆé¡Œï¼ˆHint + CSV + FLAG + æ•™å¸«è§£ç­”ï¼‰</h1>

<div class="block">
<h3>ğŸ‘¤ ä½œç­”è€…è³‡è¨Š</h3>
ç­ç´š <input id="cls">
åº§è™Ÿ <input id="num">
å§“å <input id="name">
</div>

<div id="quiz"></div>

<button id="submitBtn" onclick="submit()">é€å‡ºä½œç­”</button>
<button onclick="exportCSV()">ğŸ“¥ åŒ¯å‡º CSV</button>

<div class="block" id="result"></div>

<!-- æ•™å¸«å¯†ç¢¼è§£ç­” -->
<div class="block">
<h3>ğŸ”‘ æ•™å¸«æ¨¡å¼</h3>
<input type="password" id="teacherPwd" placeholder="è¼¸å…¥æ•™å¸«å¯†ç¢¼">
<button onclick="unlockTeacher()">è§£é–ç­”æ¡ˆ</button>
<div id="teacherPanel" style="display:none;"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script>
// =======================
// è¨­å®š
// =======================
const POINT_PER_QUESTION = 5; // æ¯é¡Œ 5 åˆ†
let penalty = 0;
let submitted = false;

// =======================
// é¡Œç›® / ç­”æ¡ˆ / æç¤º
// =======================
const data = [
  // PWN 4 é¡Œ
  { q:"PWN-1: é€€ä¼‘çš„å®ˆé–€äºº", a:"EXPLOIT_SUCCESS", h1:"è©¦è‘—æº¢å‡º buffer", h2:"libc å›ºå®šï¼ŒPIE é—œé–‰" },
  { q:"PWN-2: æœƒèªªè©±çš„èœå–®", a:"MENU_BYPASS", h1:"æª¢æŸ¥è¼¸å…¥æ ¼å¼", h2:"æ ¼å¼åŒ–è¼¸å…¥å¯èƒ½å°è‡´ overflow" },
  { q:"PWN-3: å®‰éœçš„è¨˜å¸³å“¡", a:"SIGNED_INTEGER_OVERFLOW", h1:"æ³¨æ„ signed/unsigned", h2:"ä½¿ç”¨ printf / debug è§€å¯Ÿè¨˜æ†¶é«”" },
  { q:"PWN-4: è¢«ä¿è­·çš„å¾Œé–€", a:"LEAK_CANARY", h1:"Canary å¯æ³„éœ²", h2:"debug æ¨¡å¼å¯åˆ©ç”¨" },

  // WEB 4 é¡Œ
  { q:"WEB-1: ç®¡ç†å“¡ä¸åœ¨å®¶", a:"HEADER_INJECTION", h1:"æª¢æŸ¥ HTTP header", h2:"å¯èƒ½å¯ç¹éç™»å…¥" },
  { q:"WEB-2: æ¶ˆå¤±çš„æª”æ¡ˆ", a:"PATH_TRAVERSAL", h1:"å˜—è©¦ ../", h2:"æª”æ¡ˆä¸ä¸€å®šåœ¨ /uploads" },
  { q:"WEB-3: çœ‹ä¸è¦‹çš„ç®¡ç†ä»‹é¢", a:"API_DISCOVERY", h1:"å‰ç«¯ JS æç¤º API", h2:"å˜—è©¦éš±è—è·¯å¾‘" },
  { q:"WEB-4: ä¸€æ¬¡æ€§çš„ä¿¡ä»»", a:"TOKEN_REPLAY", h1:"Token å¯ä»¥é‡æ”¾", h2:"æ™‚é–“ä¸æ˜¯å”¯ä¸€éš¨æ©Ÿ" },

  // CRYPTO 4 é¡Œ
  { q:"CRYPTO-1: é‡è¤‡çš„å®‰å…¨æ„Ÿ", a:"RSA_GCD", h1:"å…©å€‹é‡‘é‘°æœ‰å…±å› æ•¸", h2:"GCD è¨ˆç®—ç§é‘°" },
  { q:"CRYPTO-2: å¤ªçŸ­çš„éš¨æ©Ÿ", a:"IV_REUSE", h1:"IV é‡è¤‡", h2:"CBC æ¨¡å¼ä¸èƒ½é‡è¤‡" },
  { q:"CRYPTO-3: ç°½åçš„å½±å­", a:"ECDSA_NONCE_LEAK", h1:"é‡è¤‡ nonce å°è‡´ç§é‘°æ´©éœ²", h2:"æ•¸å­¸é‹ç®—å¯ç ´è§£" },
  { q:"CRYPTO-4: è‡ªå·±è¨­è¨ˆçš„åŠ å¯†", a:"CUSTOM_XOR", h1:"XOR åŠ ä½ç§»ä¸å®‰å…¨", h2:"å˜—è©¦é »ç‡åˆ†æ" },

  // REVERSE 4 é¡Œ
  { q:"REV-1: å‡è£å¾ˆè¤‡é›œ", a:"STATIC_STRINGS", h1:"è§€å¯Ÿå­—ä¸²å¸¸é‡", h2:"å‡½å¼åä¸é‡è¦" },
  { q:"REV-2: èµ°ä¸åˆ°çš„è·¯", a:"UNREACHABLE_FLAG", h1:"åˆ†ææ¢ä»¶åˆ†æ”¯", h2:"é€†å‘å¯èƒ½é€²å…¥æ­»åˆ†æ”¯" },
  { q:"REV-3: è‡ªå·±é©—è­‰è‡ªå·±", a:"MEMORY_KEY", h1:"é‡‘é‘°è—åœ¨è¨˜æ†¶é«”", h2:"åŸ·è¡Œæ™‚ dump" },
  { q:"REV-4: æ™‚é–“å·®", a:"TIMING_ATTACK", h1:"ä¸åŒè¼¸å…¥è€—æ™‚ä¸åŒ", h2:"åˆ©ç”¨ timing æ¨æ¸¬" },

  // FORENSICS 4 é¡Œ
  { q:"FOR-1: è¢«æ“¦æ‰çš„ç…§ç‰‡", a:"FILE_MAGIC", h1:"æª¢æŸ¥æª”æ¡ˆå°¾éƒ¨", h2:"ä¸æ˜¯æ‰€æœ‰æª”æ¡ˆå°¾éƒ½æ­£å¸¸" },
  { q:"FOR-2: å®‰éœçš„å°åŒ…", a:"DNS_EXFIL", h1:"åˆ†æ DNS è«‹æ±‚", h2:"åç¨±ä¹Ÿå¯èƒ½è—è³‡æ–™" },
  { q:"FOR-3: æ™‚é–“ç·šçš„è¬Šè¨€", a:"LOG_MANIPULATION", h1:"æª¢æŸ¥æ™‚é–“é †åº", h2:"å¯èƒ½ç³»çµ±æ™‚é–“ä¸å¯é " },
  { q:"FOR-4: åˆªä¸æ‰çš„ç—•è·¡", a:"DELETED_FOR_RECOVERY", h1:"æª”æ¡ˆé›–åˆªé™¤", h2:"å¯ä»¥å¾ç£å€æ¢å¾©" }
];

// =======================
// é¡Œç›®ç”Ÿæˆ
// =======================
const quiz = document.getElementById("quiz");
data.forEach((d,i)=>{
 quiz.innerHTML += `
 <div class="block">
 <b>ç¬¬ ${i+1} é¡Œï¼ˆ5 åˆ†ï¼‰</b>
 <pre>${d.q}</pre>
 <input id="a${i}" placeholder="è¼¸å…¥ç­”æ¡ˆ">
 <br>
 <button class="hintBtn" onclick="showHint(${i},1)">Hint 1</button>
 <button class="hintBtn" onclick="showHint(${i},2)">Hint 2</button>
 <div id="h${i}1" class="hint">ğŸ’¡ ${d.h1}</div>
 <div id="h${i}2" class="hint">ğŸ’¡ ${d.h2}</div>
 <div id="r${i}"></div>
 </div>`;
});

// =======================
// Hint é¡¯ç¤ºï¼ˆæ‰£åˆ†ï¼‰
// =======================
function showHint(i,n){
 if(submitted) return;
 const h = document.getElementById(`h${i}${n}`);
 if(h.style.display !== "block"){
   h.style.display = "block";
   penalty += (n===1?0.5:1);
 }
}

// =======================
// ä½œç­”èˆ‡é–å®š
// =======================
function submit(){
 if(submitted){ alert("å·²é€å‡ºä½œç­”"); return; }
 const cls  = document.getElementById("cls").value;
 const num  = document.getElementById("num").value;
 const name = document.getElementById("name").value;
 if(!cls||!num||!name){ alert("è«‹å¡«å¯«ç­ç´š/åº§è™Ÿ/å§“å"); return; }

 let correctCount=0;
 data.forEach((d,i)=>{
   const input=document.getElementById("a"+i);
   const v=input.value.trim().toUpperCase();
   const r=document.getElementById("r"+i);
   if(v===d.a){ r.innerHTML="âœ” æ­£ç¢º"; r.className="correct"; correctCount++; }
   else{ r.innerHTML="âœ˜ éŒ¯èª¤"; r.className="wrong"; }
   input.disabled=true;
 });
 document.querySelectorAll(".hintBtn").forEach(b=>b.disabled=true);

 const rawScore=correctCount*POINT_PER_QUESTION;
 const finalScore=Math.max(0,rawScore-penalty);
 const flag=(correctCount===data.length)?"<br>ğŸ´ FLAG{CTF_MASTER_OF_ALL_DOMAINS}":"";
 document.getElementById("result").innerHTML=`
 ${cls} ${num} ${name}<br>
 ç­”å°é¡Œæ•¸ï¼š${correctCount}/${data.length}<br>
 åŸå§‹åˆ†æ•¸ï¼š${rawScore}<br>
 æç¤ºæ‰£åˆ†ï¼š${penalty}<br>
 <b>æœ€çµ‚åˆ†æ•¸ï¼š${finalScore}</b>
 ${flag}
 `;
 document.getElementById("submitBtn").disabled=true;
 submitted=true;
}

// =======================
// CSV åŒ¯å‡º
// =======================
function exportCSV(){
 const headers=["ç­ç´š","åº§è™Ÿ","å§“å"];
 for(let i=0;i<data.length;i++) headers.push(`ç¬¬${i+1}é¡Œ`);
 headers.push("åŸå§‹åˆ†æ•¸","æç¤ºæ‰£åˆ†","æœ€çµ‚åˆ†æ•¸");

 const cls=document.getElementById("cls").value;
 const num=document.getElementById("num").value;
 const name=document.getElementById("name").value;
 let answers=[],correctCount=0;
 for(let i=0;i<data.length;i++){
   const v=document.getElementById("a"+i).value.trim().toUpperCase();
   answers.push(v);
   if(v===data[i].a) correctCount++;
 }
 const rawScore=correctCount*POINT_PER_QUESTION;
 const finalScore=Math.max(0,rawScore-penalty);
 let row=[cls,num,name,...answers,rawScore,penalty,finalScore];
 let csv=headers.join(",")+"\n";
 csv+=row.map(v=>`"${v}"`).join(",")+"\n";
 const BOM="\uFEFF";
 const blob=new Blob([BOM+csv],{type:"text/csv;charset=utf-8;"});
 const a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download=`${cls}_${num}_${name}_ctf.csv`;
 a.click();
}

// =======================
// æ•™å¸«å¯†ç¢¼è§£ç­”
// =======================
const TEACHER_HASH="aaf4c61ddcc5e8a2dabede0f3b482cd9aea9434d"; // md5("teacher123")

function unlockTeacher(){
 const pwd=document.getElementById("teacherPwd").value;
 if(CryptoJS.MD5(pwd).toString()!==TEACHER_HASH){
   alert("å¯†ç¢¼éŒ¯èª¤");
   return;
 }
 let html="<h4>ğŸ“˜ æ•™å¸«è§£ç­”</h4>";
 data.forEach((d,i)=>{
   html+=`ç¬¬${i+1}é¡Œç­”æ¡ˆï¼š${d.a} <br>Hint2ï¼š${d.h2}<br>`;
 });
 document.getElementById("teacherPanel").innerHTML=html;
 document.getElementById("teacherPanel").style.display="block";
}
</script>

</body>
</html>